{% extends 'FIANETSceauBundle:Extranet:extranet.html.twig' %}

{% trans_default_domain 'extranet_questionnaires_question_perso' %}

{% block title %}
    {{ parent() }} : {% trans %}title_page{% endtrans %}
{% endblock %}

{% block extranet_stylesheets %}
    {% stylesheets
    'bundles/fianetsceau/css/extranet/questionnaires.css'
    filter='cssrewrite' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block extranet_body %}
    <div class="content">
        <div class="block-message">
            {% for messageSucces in app.session.flashbag.get('creation_succes') %}
                <p class="succes">{{ messageSucces }}</p>
            {% endfor %}
            {% for messageErreur in app.session.flashbag.get('creation_erreur') %}
                <p class="erreur">{{ messageErreur }}</p>
            {% endfor %}
        </div>

        <h1>{% trans %}titre_page{% endtrans %}</h1>

        <div class="block-total">
            <div class="block-total-part1-2">
                <ul>
                    <li>
                        {% trans %}frise1{% endtrans %}<br/>
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-quest-create.png') }}" width="66" height="54" alt=""/>
                    </li>
                    <li class="arrow">
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-arrow.png') }}" width="17" height="24" alt=""/>
                    </li>
                    <li>
                        {% trans %}frise2{% endtrans %}<br/>
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-quest-valid.png') }}" width="82" height="55" alt=""/>
                    </li>
                    <li class="arrow">
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-arrow.png') }}" width="17" height="24" alt=""/>
                    </li>
                    <li>
                        {% trans %}frise3{% endtrans %}<br/>
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-quest-online.png') }}" width="89" height="54" alt=""/>
                    </li>
                    <li class="arrow">
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-arrow.png') }}" width="17" height="24" alt=""/>
                    </li>
                    <li>
                        {% trans %}frise4{% endtrans %}<br/><br/>
                        <img src="{{ asset('bundles/fianetsceau/images/extranet/picto-quest-stat.png') }}" width="92" height="54" alt=""/>
                    </li>
                </ul>
            </div>

            <div class="block-total-part3">
                <div class="block-info-comp">
                    <p>
                        <strong>
                            Profitez de nos questionnaires de satisfaction pour solliciter l'avis de vos clients sur
                            un élément spécifique : une opération promotionnelle, un service spécifique, une refonte de
                            votre site, une nouvelle mise en avant de vos produits… Tous ces évènements peuvent être la
                            source de retours précis et qualitatifs sur vos actions.<br/>
                            <br/>
                            Vous pouvez ajouter deux questions par questionnaire envoyé, post-achat ou post-livraison en
                            choisissant la date qui convient le mieux. Ciblez ainsi le moment le plus opportun pour
                            communiquer avec vos clients. Les questions seront ajoutées à la fin du
                            questionnaire.
                        </strong>
                    </p>
                </div>
            </div>
        </div>

        <h1>{% trans %}titre2_page{% endtrans %}</h1>

        <div class="block-total">
            {{ form_start(form) }}
                {% trans %}Type de question{% endtrans %} : <div class="select select-inline">{{ form_widget(form.questionType, {'attr' : {'onchange' : 'changerTypeQuestion(this.value);'}} ) }}</div><br />
                <br />
                {% if questionType is not null %}
                    <div id="libelle">{% trans %}Libellé de la question{% endtrans %} : {{ form_widget(form.libelle) }}</div><br />

                    {% if questionType.id == 3 %}
                        <div id="notation">{% trans %}Borne de notation (incluses){% endtrans %} : {{ form_widget(form.valeurMin) }} à {{ form_widget(form.valeurMax) }}</div><br />
                    {% endif %}

                    {{ form_widget(form.reponses) }}

                    {% if questionType.id != 4 %}
                        <div id="ajout_reponse">Pour ajouter une réponse, <a href="#" id="lien_ajout_reponse">cliquez ici</a></div><br />
                    {% endif  %}

                    <div id="dates">{% trans %}Date de publication{% endtrans %} : {{ form_widget(form.dateDebut) }} au {{ form_widget(form.dateFin) }}</div><br />

                    <button type="submit">{% trans from 'commun' %}commun_valider{% endtrans %}</button>
                {% endif %}
            {{ form_end(form) }}
        </div>

    </div>
{% endblock %}

{% block extranet_javascripts %}
    {% javascripts
    'components/jquery-ui/ui/datepicker.js'
    'bundles/fianetsceau/js/calendrier.js' %}
    <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}

    {% if app.request.locale != 'en' %}
        <script src="{{  asset('bundles/fianetsceau/js/calendrier-'~ app.request.locale ~'.js') }}" type="text/javascript"></script>
    {% endif  %}

    <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}" type="text/javascript"></script>

    <script type="text/javascript">
        afficherCalendrier('fianet_sceaubundle_question_dateDebut');
        afficherCalendrier('fianet_sceaubundle_question_dateFin');

        {% if questionType is not null %}
            $(document).ready(function() {
                var container = $('div#fianet_sceaubundle_question_reponses');

                $('#lien_ajout_reponse').click(function(e) {
                    ajoutReponse(container);
                    e.preventDefault();
                    return false;
                });

                {# Au chargement de la page il faut soit ajouter la première réponse (formulaire vide) soit afficher tous les liens de suppression (formulaire rempli) #}
                var index = container.find(':input').length;
                if (index == 0) {
                    ajoutReponse(container);
                } else {
                    container.children('div').each(function() {
                        ajoutLienSuppression($(this));
                    });
                }

                function ajoutReponse(container) {
                    var prototype = $(container.attr('data-prototype').replace(/__name__label__/g, 'Réponse n°' + (index+1)).replace(/__name__/g, index));

                    ajoutLienSuppression(prototype);
                    container.append(prototype);

                    index++;
                }

                function ajoutLienSuppression(prototype) {
                    {# Le lien de suppression n'est pas affiché pour les commentaires car il n'y a au mini et au maxi une réponse #}
                    if ($('#fianet_sceaubundle_question_questionType').value != 4) {
                        var deleteLink = $('<a href="#" class="pointer">Supprimer la réponse</a>');

                        prototype.append(deleteLink);

                        deleteLink.click(function (e) {
                            prototype.remove();
                            e.preventDefault();
                            return false;
                        });
                    }
                }
            });
        {% endif %}

        function changerTypeQuestion(questionType)
        {
            document.location.href = Routing.generate(
                    'extranet_questionnaires_questions_personnalisees_question_type',
                    {id: questionType},
                    true
            );
        }

    </script>
{% endblock %}